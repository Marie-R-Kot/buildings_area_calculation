# buildings_area_calculation
## ML Streamlit app for calculating the area of ​​buildings

**Deploy: https://area-calculation.streamlit.app/**

### Про вывод приложения по ссылке из сна
Если вы видите данный текст: 
>"This app has gone to sleep due to inactivity. Would you like to wake it back up?" 

...то нажмите кнопку, чтобы разбудить приложение.

### Суть
Данный проект посвящен распознаванию зданий на геоснимах с помощью модели сегментации, но обо всем по порядку. 

### Данные
В работе использовался [Inria Dataset](https://project.inria.fr/aerialimagelabeling/).

Датасет состоит из геоснимков пяти городов в высоком разрешении. 
Для удобства обучения снимки были разрезаны на тайлы меньшего размера.
Из данного датасета были сформированы подвыборки: 
* Тренировочная (городов Остин, Тироль и Вена)
* Валидационная (Китсап)
* Тестовая (Чикаго)

Подробнее о предобработке и формировании подвыборок можно прочитать в файле `data_prepocessing.py`

### Модель
Основная задача данного проекта - определение площади застройки на некоторой местности. Исходя из этого, типом решаемой задачи была выбрана сегментация. Маски сегментации в перспективе должны более точно передавать различные формы зданий, а значит погрешность в вычислении площади будет меньше. 

И для экспериментов, и в окончательном варианте использовалась библиотека [segmentation_models_pytorch](https://segmentation-modelspytorch.readthedocs.io/en/latest/).

Была выбрана модель на основе архитектруры **UNet** с использованием комбинированного лосса. 
Подбробнее о выборе модели и лоссов можно прочитать в файле `???????????.py`

### Приложение
Демо-приложение было создано на Streamlit и реализовано в виде "чата". 
Для использования требуется ввести адрес области, для которой нужно посчитать площадь застройки - или выбрать область на встроенном виджете карты.

После анализа и обращения к модели будет получена маска с найденными моделью зданиями, а так же площадь застройки в квадратных метрах и процент застройки для данной области. 

#### Что же отдаётся модели? 

После демонстрации области в виджете карты на Streamlit, координаты выбранной области отдаются в [ESRI API World Imagery](https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/1).

Данный API позволяет забирать изображения со спутников для всего мира. Изображения можно забирать в различном приближении: так, при zoom=0 будет получен 1 тайл, на котором будет изображён весь мир. Для zoom=1, мир будет покрыт уже 4 тайлами, и т.д. 

Таким образом, при заданном зуме, каждый тайл покрывает определенную область. То есть, зная мировые координаты области в виджете карты, можно получить тайлы, которые её покрывают, и затем забрать их через API, чтобы получить изображение. 

Почему нельзя забрать все изображение целиком? Из-за разрешения - чем меньше зум, тем хуже разрешение. В данном проекте разрешение подбирается динамически, чтобы быть близким к разрешению исходного датасета. 

Однако, у такой системы есть и другой нюанс. ESRI - открытый сервис, и снимки в различных частых мира могут отличаться как качеством, так и вообще для некоторых областей может просто не быть снимков необходимого разрешения. А значит данные, подаваемые модели в продакшене, могут значительно отличаться как между собой, так и от тренировочных данных. 

### Если остались вопросы или что-то сломалось
Напишите мне в Telegram: [@marie_kotikova](https://t.me/marie_kotikova)